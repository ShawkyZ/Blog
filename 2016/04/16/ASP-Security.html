
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ASP.Net Web Application Security</title>
    <meta name="description" content="">
    <meta name="author" content="Abdelrhman Shawky">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes//bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/themes//bootstrap-3/bootstrap/css/bootstrap-flipped.css" rel="stylesheet">
	<link href="/assets/themes//bootstrap-3/bootstrap/css/bootstrap-rtl.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes//bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes//bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="/assets/themes//css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

	
	<link rel="shortcut icon" type="image/png" href="/assets/favico.ico">
    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">مدونة شوقي</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
		 
          <ul class="nav navbar-nav">
            
            
            


  
    
      
      	
      	<li><a href="/ContactUs">تواصل معي</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive">الأرشيف</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags">Tags</a></li>
      	
      
    
  
    
      
    
  



          </ul>
         <form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">بحث</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>ASP.Net Web Application Security </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>16 Apr 2016</span>
    </div>
    <div class="post-content col-xs-8" style="font-size: 17px">
      
<p><img src="/assets/logo-aspnet.jpg" alt="" class="img-responsive center-block" /></p>

<p>في التدوينة دي هتكلم  بصورة عامة عن بعض الخطوات اللي ممكن تعملها عشان تحمي ال Web App بتاعك.</p>

<p>في العادي ممكن تطبقها على اي Web App بس هقترح Libraries او tools او Best Practices ممكن تستعملها لو شغال بال ASP.Net.</p>

<h2 id="cross-site-scriptinghttpswwwowasporgindexphpcross-sitescriptingxss"><a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)">Cross Site Scripting</a></h2>

<p>فيه طرق كتير معروفة عشان تـPrevent ال XSS بانواعها ، هتعتمد يا اما على ال Input Validation 
انك بتشوف هل ال User مثلًا حاول يكتب tag معينة زي script tag فتروح تمسحها، او انك تـ Html Encode ال output.</p>

<ul>
  <li>مبدأيًا ASP.Net بتوفرلك Input Validation لل Malicious Characters ، و ده حلو ، بس المشكلة انه بيعتمد على Black List.
بمعنى فيه زي list كده ببعض ال malicious payloads اللي ممكن تسببلك مشاكل ، و ده اكيد مش هينفع معاك ، حتى لو الليست فيها 10000 payload ، ممكن حد يعديها.
فالحل لو عايز تعمل  Input Validation استعمل Whitelist ، يعني هتسمح بـ Inputs معينة بس و الباقي هتشيله ، ممكن تستعمل AntiXss Library ممكن تنزلها من Nuget</li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">PM</span><span class="o">&gt;</span> <span class="n">Install</span><span class="o">-</span><span class="n">Package</span> <span class="n">AntiXSS</span></code></pre></figure>

<p><a href="https://msdn.microsoft.com/en-us/library/system.web.security.antixss.antixssencoder(v=vs.110).aspx">هتلاقي ال documentation بتاعها من هنا</a></p>

<ul>
  <li>
    <p>برضه AntiXss ممكن تHtml Encodeالoutput بتاعك.</p>
  </li>
  <li>
    <p>في حالة انك مثلا عايز تعمل Html Live Editor لأي سبب كان ، أكيد ده مش هيبقى مخاطره اكتر انك تعمله ، بس لو اضطريت هتحتاج تـSanitize ال Html ده و تعتمد على Whitelist.
فيه Library  كنت استعملتها قبل كده بسيطة جدًا ، و فيها ال WhiteList و ممكن تعدل عليها ، و كمان مكتوبلها Unit Tests على كل ال payloads اللي مكتوبة في الXSS Cheat Sheet من OWASP ، 
 <a href="https://github.com/mganss/HtmlSanitizer">ده اللينك بتاعها</a></p>
  </li>
  <li>
    <p>استعمل ال Header X-XSS-Protection</p>
  </li>
  <li>
    <p>Flag ال Cookies بتاعتك بـ HTTPOnly عشان في حالة لو فيه فعلًا XSS الattacker ميقدرش يوصل للـ Cookies.</p>
  </li>
</ul>

<p><br /></p>

<h2 id="cross-site-request-forgeryhttpswwwowasporgindexphpcross-siterequestforgerycsrf"><a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)">Cross Site Request Forgery</a></h2>

<ul>
  <li>من اول VS 12 لما تعمل ASP.Net Web Forms App في ال Master Page بيكون فيه Prevention لل CSRF ، 
لو شغال على project 
<a href="http://software-security.sans.org/developer-how-to/developer-guide-csrf">قديم ارجع للينك ده</a>
ده هيحميك لو هتستعمل ال Master Page دي و هتستعمل ال ASP.Net View States 
بس فرضًا لو كنت كتبت قبل كده صفحة او Web Service مثلا و بتاخد parameter بـ Get Request و معملتش اي check ، حاجة مثلا زي</li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">GET</span> <span class="n">SITE</span><span class="o">/</span><span class="n">deleteuser</span><span class="p">.</span><span class="n">aspx</span><span class="o">?</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span></code></pre></figure>

<p>يبقى اكيد اللي كان مكتوب في ال Master Page مش هيبقى ليه أي تأثير في حالتك ، فهتضطر تـimplement انت ال check بنفسك ، ممكن ترجع للـ <a href="https://www.owasp.org/index.php/Anti_CSRF_Tokens_ASP.NET">reference ده</a></p>

<ul>
  <li>ال ASP.Net MVC بت prevent ال CSRF بانها بتحط 2 tokens واحد في ال HTML Form و التاني بيبقى  الcookie و ده لحد كده كويس.
بس برضه هتقابلك نفس المشكلة لو عندك مثلا Web Service و هتبعتلها Ajax Request من الClient فهتحتاج الtokens دي تضيفها لل Request بتاعتك <a href="http://www.asp.net/web-api/overview/security/preventing-cross-site-request-forgery-csrf-attacks">ممكن تشوف اللينك ده</a></li>
</ul>

<p><br /></p>

<h2 id="clickjackinghttpswwwowasporgindexphpclickjacking"><a href="https://www.owasp.org/index.php/Clickjacking">ClickJacking</a></h2>

<p>قبل ما تفكر في الحل اسال نفسك ، اي هي الصفحات اللي هتتاخد كـ iframe ؟ 
هل كلها هتستعمل كـ iframe ؟ طب هتستعمل برة ال domain بتاعي ؟
عامة كده كده لازم الصفحات اللي ليها علاقة ال settings بتاعت ال user مثلا او بيحصل فيها اي عمليات حساسة ، لازم تخليها متسمحش انها تتاخد كـ iframe برة ال domain بتاعك. عشان ت Prevent ال Click Jacking هتضيف ال <strong>x-frame-options header</strong> و هتـ set ال attribute يا اما</p>

<ul>
  <li>Deny</li>
  <li>ALLOW-FROM</li>
  <li>SAMEORIGIN</li>
</ul>

<p>لو <strong>DENY</strong> هتمنع ان الصفحة تتـrender في اي iframe.</p>

<p>او <strong>SAMEORIGIN</strong> و هتتrender بس في حالة ان ال parent هيكون من نفس ال domain</p>

<p>او <strong>ALLOW-FROM</strong> و بتحدد انت ال top level browing context يكون من domain معين ،</p>

<p>تفاصيل اكتر <a href="https://blogs.msdn.microsoft.com/ieinternals/2010/03/30/combating-clickjacking-with-x-frame-options/">هتلاقيها هنا</a></p>

<p><br /></p>

<h2 id="unrestricted-file-uploadhttpswwwowasporgindexphpunrestrictedfileupload"><a href="https://www.owasp.org/index.php/Unrestricted_File_Upload">Unrestricted File Upload</a></h2>

<p>اكيد مش هينفع تسمح  للـ user انه يـ Upload اي file عندك ، فلازم يكون عندك Whitelist بانواع ال files اللي هتسمح بيها بس. 
مثلا انت هتسمح بـ : txt, doc, pdf 
فممكن تعمل 2 Checks</p>

<ul>
  <li>الاول تشوف ال File Type اللي جاي و لو مش موجود في ال Whitelist بتاعتك متقبلوش.</li>
  <li>التاني هتشوف ال File Signature ، كل File Type بيكون ليه FIle Signature معينة بتكون في اول 20 byte منه 
<a href="https://en.wikipedia.org/wiki/List_of_file_signatures">ممكن تشوفهم من هنا</a>
فبرضه هتعمل Whitelist بال File Signatures اللي هتقبلها و تcheck لو كان ال File اللي جاي ده ال signature بتاعته موجودة في ال Whitelist ولا لأ بانك هتقرا اول 20 byte من ال File ، ده عشان مثلًا لو ال user غير ال extension بتاع ال exe file لـ txt مثلا ، في العادي دي مش مشكلة طلاما هو مش executable و محدش هيعمله execute، بس فرضًا لو كان فيه اي flow عندك تخليه يغير اسم ال file مثلا فساعتها ممكن تبقى مشكلة.
عامة  “Better Safe Than Sorry”.</li>
</ul>

<p><br /></p>

<h2 id="sql-injectionshttpswwwowasporgindexphpsqlinjection"><a href="https://www.owasp.org/index.php/SQL_Injection">SQL Injections</a></h2>

<ul>
  <li>
    <p>اسهل طريقة عشان تـ prevent ال SQL Injection انك تستعمل Parameterized Queries ، يعني لو انت شغال بال ADO.Net مثلًا و هتستعمل SqlCommand Class و ضيف ال Parameters بتاعتك من ال SqlCommand Object ، زي مثلا command.Pramaters.Add(..) بدل ما تكتب ال query بتاعك و concat بالparameters على طول.</p>
  </li>
  <li>
    <p>و لو بتستعمل ORM زي NHibernate او Entity FrameWork بيكون فيهم Implemented Mechanisms عشان تـ Prevent ال Sql Injections.</p>
  </li>
  <li>
    <p>اياك تstore ال passwords كـ Plain Text ، لازم تـ Encrypt و تـ Salt الHash اللي طلع بعد كده تـ Store</p>
  </li>
</ul>

<p><br /></p>

<h2 id="privilege-escalationhttpswwwowasporgindexphptestingforprivilegeescalationotg-authz-003"><a href="https://www.owasp.org/index.php/Testing_for_Privilege_escalation_(OTG-AUTHZ-003)">Privilege Escalation</a></h2>

<p>لو عندك مثلا 2 Roles للـ Users بتوعك (Admin,User) فلازم تتأكد ان ال User العادي ميقدرش ينفذ نفس العمليات اللي يقدر ينفذها ال Admin.
أسهل طريقة عشان تtest بيها الموضوع انك تحاول تـ Execute Function المفروض انها تشتغل بصلاحيات الـ Admin بس.
عشان تـ Prevent الـ Privilege Escalations الحل الوحيد انك تتأكد ان كل User تحت Role ميقدرش ينفذ اي عمليات تانية برة ال roles scope بتاعته ، فلازم تعمل permission check عالFunctions اللي هتتنفذ لكل rule منهم. غير كده اكتب Unit Tests و جرب Test Cases زي مثلا انك تـ Execute Function معينة و انت معندكش الPermission.</p>

<p><br /></p>

<h2 id="indirect-object-referencehttpswwwowasporgindexphptestingforinsecuredirectobjectreferencesotg-authz-004"><a href="https://www.owasp.org/index.php/Testing_for_Insecure_Direct_Object_References_(OTG-AUTHZ-004)">Indirect Object Reference</a></h2>
<p>عشان تـ Prevent ال IDOR لازم تتأكد من كذا حاجة:</p>

<ol>
  <li>ال Ids عندي مينفعش انها تتـguess ، خلي الـ Ids بتاعتك GUID مثلًأ.</li>
  <li>اتاكد ان كل User تحت Role معينة ميقدرش يعمل اي حاجة برة ال permission set اللي انت محددها في ال Role دي.</li>
</ol>

<p><br /></p>

<h2 id="open-redirectionhttpswwwowasporgindexphpunvalidatedredirectsandforwardscheatsheet"><a href="https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet">Open Redirection</a></h2>
<p>ابسط طريقة انك تـCheck لو كان ال Url اللي عايز يروحله Local Url ولا لأ ، لو لأ رجعه عال Index بتاعتك مثلًا او تخليه يـ Confirm انه هيـredirect برة ال domain بتاعك.
ممكن برضه تاخد <a href="http://www.asp.net/mvc/overview/security/preventing-open-redirection-attacks">اللينك ده كـ reference</a></p>

<p><br /></p>

<h3 id="section">مصادر ممكن تقرأ منها:</h3>

<ul>
  <li><a href="http://www.troyhunt.com/2011/12/free-ebook-owasp-top-10-for-net.html">كتاب OWASP Top 10 For .Net من Troy Hunt</a></li>
  <li><a href="https://www.owasp.org/index.php/Top_10_2013-Top_10">OWASP TOP 10 2013 Reference</a></li>
</ul>

<p><br /></p>

<blockquote>
  <p>حاجة اخيرة: لو بتستعمل اي third-party libraries دايمًا خليك up to date ، عشان ممكن مثلا لو بتستعمل JS Library معينة ، ممكن يكون هي نفسها فيها مثلًا XSS Vuln ساعتها انت برضه ممكن يبقى عندك نفس المشكلة.</p>
</blockquote>

    </div>
    

  
    <ul class="tag_box inline col-xs-12">
      <li><i class="glyphicon glyphicon-tags"></i></li>
      
      


  
     
    	<li><a href="#ASP.Net-ref">ASP.Net <span>2</span></a></li>
     
    	<li><a href="#Security-ref">Security <span>1</span></a></li>
    
  



    </ul>
    
 
 
  <div class="share-page">
  

  <div class="pull-right share-links">
    
      <a class = "fa fa-facebook" href="https://facebook.com/sharer.php?u=/2016/04/16/ASP-Security" rel="nofollow" target="_blank" title="Share on Facebook"></a>
    

    
      <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?text=ASP.Net Web Application Security&url=/2016/04/16/ASP-Security" rel="nofollow" target="_blank" title="Share on Twitter"></a>
    

    

    
      <a class="fa fa-linkedin" href="http://www.linkedin.com/shareArticle?url=/2016/04/16/ASP-Security&title=ASP.Net Web Application Security" rel="nofollow" target="_blank" title="Share on LinkedIn"></a>
    

    

    

    

    

    


  </div>
</div>

  
 
    
    <ul class="pagination col-xs-12">
    
      <li class="prev"><a href="/2015/02/17/host-aspnet-on-linux" title="Host ASP.Net WebApps On Linux">&laquo; Previous</a></li>
    
      <li><a href="/archive.html">Archive</a></li>
    
      <li class="next disabled"><a>Next &rarr;</a>
    
    </ul>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_developer = 1;
    var disqus_shortname = 'shawkyz'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>

    </div>
<br/>
    <div class="footer">
      <div class="container">
        <p><a href="http://github.com/ShawkyZ">2016 Abdelrhman Shawky &copy;</a>
        </p>
      </div>
    </div>

    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-68680312-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/assets/themes//bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

